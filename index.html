<!DOCTYPE html>
<html>
<head>
  <title>Geometry Dash</title>
  <style>
    body {
      margin: 0;
      background: #222;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      background: #333;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="400"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let player = { x: 50, y: 300, size: 20, dy: 0, gravity: 0.8, jumpPower: -17, onGround: false };
let speed = 6; // faster start
let score = 0;
let highScore = localStorage.getItem("highScore") || 0;
let obstacles = [];
let spawnTimer = 0;
let gameOver = false;
let gameWon = false;

function jump() {
  if (player.onGround) {
    player.dy = player.jumpPower;
    player.onGround = false;
  }
}

document.addEventListener('keydown', e => { if (e.code === 'Space') jump(); });
document.addEventListener('mousedown', jump);

function resetGame() {
  player.y = 300;
  player.dy = 0;
  speed = 6;
  score = 0;
  obstacles = [];
  spawnTimer = 0;
  gameOver = false;
  gameWon = false;
}

function spawnObstacle() {
  let type = Math.random() < 0.5 ? 'block' : 'spike';
  obstacles.push({
    x: canvas.width,
    y: type === 'block' ? 350 : 360,
    width: type === 'block' ? 40 : 20,
    height: type === 'block' ? 50 : 40,
    type: type
  });

  // 50% chance to spawn second obstacle with the first
  if (Math.random() < 0.5) {
    let secondType = type === 'block' ? 'spike' : 'block';
    obstacles.push({
      x: canvas.width + (secondType === 'block' ? 50 : 40),
      y: secondType === 'block' ? 350 : 360,
      width: secondType === 'block' ? 40 : 20,
      height: secondType === 'block' ? 50 : 40,
      type: secondType
    });
  }
}

function update() {
  if (gameOver || gameWon) return;

  player.dy += player.gravity;
  player.y += player.dy;

  if (player.y >= 300) {
    player.y = 300;
    player.dy = 0;
    player.onGround = true;
  }

  spawnTimer--;
  if (spawnTimer <= 0) {
    spawnObstacle();
    spawnTimer = 90 + Math.random() * 40; // varied spacing
  }

  for (let obs of obstacles) {
    obs.x -= speed;
    if (
      player.x < obs.x + obs.width &&
      player.x + player.size > obs.x &&
      player.y < obs.y + obs.height &&
      player.y + player.size > obs.y
    ) {
      gameOver = true;
      if (score > highScore) {
        highScore = score;
        localStorage.setItem("highScore", highScore);
      }
    }
  }

  obstacles = obstacles.filter(o => o.x + o.width > 0);

  score++;
  if (score % 500 === 0) speed += 0.5;

  if (score >= 10000) {
    gameWon = true;
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "#FFD700";
  ctx.fillRect(player.x, player.y, player.size, player.size);

  for (let obs of obstacles) {
    if (obs.type === 'block') {
      ctx.fillStyle = "#00BFFF";
      ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
    } else {
      ctx.fillStyle = "#FF0000";
      ctx.beginPath();
      ctx.moveTo(obs.x, obs.y + obs.height);
      ctx.lineTo(obs.x + obs.width / 2, obs.y);
      ctx.lineTo(obs.x + obs.width, obs.y + obs.height);
      ctx.closePath();
      ctx.fill();
    }
  }

  ctx.fillStyle = "#fff";
  ctx.font = "20px Arial";
  ctx.fillText(`Score: ${score}`, 20, 30);
  ctx.fillText(`High Score: ${highScore}`, 20, 60);

  if (gameOver) {
    ctx.fillStyle = "red";
    ctx.font = "40px Arial";
    ctx.fillText("Game Over", canvas.width / 2 - 100, canvas.height / 2);
    ctx.font = "20px Arial";
    ctx.fillText("Press Space or Click to Restart", canvas.width / 2 - 140, canvas.height / 2 + 40);
  }

  if (gameWon) {
    ctx.fillStyle = "lime";
    ctx.font = "50px Arial";
    ctx.fillText("YOU WIN!", canvas.width / 2 - 130, canvas.height / 2);
  }
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

document.addEventListener('keydown', e => {
  if (gameOver && e.code === 'Space') resetGame();
});
document.addEventListener('mousedown', () => {
  if (gameOver) resetGame();
});

gameLoop();
</script>
</body>
</html>
